
<!DOCTYPE html>

<html lang="ru" >
<head>
	
<meta charset="UTF-8">
 <title>Chains</title>
	
  <link rel="stylesheet" href="css/style.css">		
 </head>
	
<body>
    <div class="container">
<nav class="navbar" role="navigation" aria-label="main navigation">
            <div class="navbar-brand">
              <span class="navbar-item" href="">
                <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 64 64" xmlns:xlink="http://www.w3.org/1999/xlink">
                  <defs>
                    <linearGradient id="c" x1="47.952%" x2="47.952%" y1="97.595%" y2="0%">
                      <stop stop-color="#FFB300" offset="0%"></stop>
                      <stop stop-color="blue" offset="61.372%"></stop>
                      <stop stop-color="blue" offset="100%"></stop>
                    </linearGradient>
                    <path id="a" d="M0,4.99424261 C0,2.23599858 2.2402674,0 4.99531509,0 L59.0046849,0 C61.7635213,0 64,2.22982375 64,4.99424261 L64,51.0057574 C64,53.7640014 61.7597326,56 59.0046849,56 L4.99531509,56 C2.23647875,56 0,53.7701762 0,51.0057574 L0,4.99424261 Z"></path>
                    <mask id="d" width="64" height="56" x="0" y="0" fill="white">
                      <use xlink:href="#a"></use>
                    </mask>
                    <path id="b" d="M0,4.99424261 C0,2.23599858 2.2402674,0 4.99531509,0 L59.0046849,0 C61.7635213,0 64,2.22982375 64,4.99424261 L64,51.0057574 C64,53.7640014 61.7597326,56 59.0046849,56 L4.99531509,56 C2.23647875,56 0,53.7701762 0,51.0057574 L0,4.99424261 Z"></path>
                    <mask id="e" width="64" height="56" x="0" y="0" fill="white">
                      <use xlink:href="#b"></use>
                    </mask>
                  </defs>
                  <g fill="none" fill-rule="evenodd">
                    <g transform="translate(0 4)">
                      <use fill="#FFF" stroke="url(#c)" stroke-width="6" mask="url(#d)" xlink:href="#a"></use>
                      <rect width="9.622" height="1.874" x="19.037" y="20.894" fill="#FFFFFF"></rect>
                      <polygon fill="#FFFFFF" points="9.573 9.2 5.62 7.109 8.487 0 .016 7.635 3.738 10.153 1.101 16.836" transform="translate(6.53 6.838)"></polygon>
                    </g>
                    <g transform="translate(0 4)">
                      <use fill="#FFF" stroke="url(#c)" stroke-width="6" mask="url(#e)" xlink:href="#b"></use>
                      <rect width="9.622" height="1.874" x="19.037" y="20.894" fill="green"></rect>
                      <polygon fill="green" points="9.573 9.2 5.62 7.109 8.487 0 .016 7.635 3.738 10.153 1.101 16.836" transform="translate(6.53 6.838)"></polygon>
                    </g>
                  </g>
                </svg>
              </span>
              <span class="navbar-item" href="">
                <h1 id="time"></h1><h1 id="t" style="display:none;"></h1><h1 id="status"><!-- - [0] : connect : true (проверка соединения)--></h1>
    <code id="a1" style="display:none;"></code>
    <!--<br>-->
    <decrypted id="a2"></decrypted><!--
    <h1 style="
    position: absolute;
    top: 45px;
"> - [1] : создание блоков</h1>-->
              </span>
          
              <button class="button navbar-burger">
                <span></span>
                <span></span>
                <span></span>
              </button>
            </div>
          </nav>
	</div>
	
<div class="container">	    
  <pre><span style="
    color: violet;
">class</span> <span style="
    color: blue;
">Block</span>
      <span style="
    color: orange;
">{</span>
        <span style="
    color: burlywood;
">constructor</span><span style="
    color: orange;
">(</span><span style="
    color: green;
    background: #fff;
    border-radius: 7px;
    padding: 5px;
    ">index</span><span style="
    color: orange;
">,</span> <span style="
    background: #fff;
    border-radius: 7px;
    padding: 5px;
    color: green;
    ">timeStamp</span><span style="
    color: orange;
">,</span> <span style="
    background: #fff;
    border-radius: 7px;
    padding: 5px;
    color: green;
            ">data</span><span style="
    color: orange;
">,</span> <span style="
    background: #fff;
    border-radius: 7px;
    padding: 5px;
    color: green;
">previousHash</span><span style="
    color: orange;
">)</span>
        <span style="
    color: orange;
">{</span>
          <span style="
    color: violet;
">this</span><span style="
    color: orange;
">.</span><span style="
    color: green;
">index</span> <span style="
    color: burlywood;
">=</span> <span style="
    color: orange;
">index</span><span style="
    color: burlywood;
		  ">;</span>                                                                                                             
          <span style="
    color: violet;
">this</span>.<span style="
    color: green;
">timeStamp</span> <span style="
    color: burlywood;
">=</span> <span style="
    color: orange;
">timeStamp</span>;                                                                                                                 
          <span style="
    color: violet;
">this</span>.data = data;
          <span style="
    color: violet;
">this</span>.previousHash = previousHash;
          <span style="
    color: violet;
                       ">this</span>.<span style="
    color: green;
">hash</span> = <span style="
    color: blue;
">this</span>.<span style="
    color: green;
">calculateHash</span><span style="
    color: orange;
">()</span>;
          <span style="
    color: violet;
">this</span>.nonce = 0;                                                                                                   
        <span style="
    color: orange;
">}</span>     
        <span style="
    color: blue;
">calculateHash</span><span style="
    color: orange;
">()</span>
        <span style="
    color: orange;
">{</span>
        return Encrypt.SHA256(this.index + this.previousHash + this.timeStamp + this.data + this.nonce).toString();
        }        
        mineBlock(difficulty)                                                                                                         
        {
          while(this.hash.substring(0,difficulty) !== Array(difficulty + 1).join("0"))
            {
              this.nonce++;
              this.hash = this.calculateHash();
            }
          console.log(" + блок "+this.index+" : " + this.hash);<center style="
    position: absolute;
    right: 275px;
    top: 100px;
     border-radius: 8px;
    /*box-shadow: 0 1px 1px rgba(0,0,0,0.25), 0 1px 1px;*/
    padding: 23px;
    background: #fff;"><svg xmlns="
http://www.w3.org/2000/svg
" width="103" height="101.4" viewBox="0 0 103 101.4">
<circle class="st16" cx="51.7" cy="50.7" r="50.7" id="Layer_3"></circle>
<g id="stuffs"><path class="st29" d="M84.9 56.1H17.8c-.6 0-1-.5-1-1V22.3c0-.5.4-1 1-1h67.1c.5 0 1 .5 1 1v32.8c0 .6-.4 1-1 1z">
</path>
<path class="st17" d="M101.3 88.5V94c0 .7-.5 1.2-1.1 1.2H3.1c-.6 0-1.1-.6-1.1-1.2v-5.5">
</path>
<path class="st22" d="M90.6 15H12.2c-.6 0-1.1.6-1.1 1.2V63h80.7V16.3c-.1-.7-.6-1.3-1.2-1.3zm-3.5 42.8c-.7.7-7.1 1-8.9 1-5.2 0-23.2-.5-23.7-.5h-9.6c-.6 0-27.3.6-28.1-.1-.7-.7-1.4-2.9-1.2-4 0-.4-.5-31.5.1-32.1 1.5-1.3 3.3-1.8 5.1-2 .7-.1 1.4-.1 2.2-.2 7.1-.5 49.6-.5 55.5-.4 10.6.3 8.6 2.1 8.3 8.5-.3 8 1.3 28.8.3 29.8zm14.2 26.5l-9-19.9c0-.7-.5-1.2-1.1-1.2H11.6c-.6 0-1.1.6-1.1 1.2L2 84.3v4.4c0 .7.5 1.2 1.1 1.2h97.1c.6 0 1.1-.6 1.1-1.2v-4.1h-.1c.1-.1.1-.2.1-.3zm-35.6-4.8l-.3.3c-.2.4-.5.7-1.1.8H64c-1 .3-2.2.3-3.2.3-3.4.1-6.8-.1-10.3-.3-4.9.9-9.7 1.8-14.5-.1-.6-.2-1.1-.8-.9-1.5.1-.4.3-.9.5-1.6.1-1.5.4-2.6 1-3.4.1-.2.1-.4.1-.5.1-1.1 1.4-1.5 2.1-1 1.2-.4 2.8-.5 4.6-.4 4.2.1 8.3.6 12.5.3 2.2-.1 4.7-.6 6.8.2 2.6 1 5.1 4.3 3 6.9z">
</path>
<path class="st18" d="M101.3 84.3v5.5c0 .7-.5 1.2-1.1 1.2H3.1c-.6 0-1.1-.6-1.1-1.2v-5.5">
</path>
<path class="st40" d="M22 36.6h-3.6c-2.2 0-4-1.8-4-4v-.3c0-2.2 1.8-4 4-4H22c2.2 0 4 1.8 4 4v.3c0 2.2-1.8 4-4 4zm63 0h-3.6c-2.2 0-4-1.8-4-4v-.3c0-2.2 1.8-4 4-4H85c2.2 0 4 1.8 4 4v.3c0 2.2-1.8 4-4 4zm-47.3 0H34c-2.2 0-4-1.8-4-4v-.3c0-2.2 1.8-4 4-4h3.6c2.2 0 4 1.8 4 4v.3c.1 2.2-1.7 4-3.9 4z">
</path>
<path class="st0" d="M33.4 33.9H22.5c-.6 0-1.1-.5-1.1-1.1 0-.6.5-1.1 1.1-1.1h10.9c.6 0 1.1.5 1.1 1.1 0 .6-.5 1.1-1.1 1.1zm15.6 0H38c-.6 0-1.1-.5-1.1-1.1 0-.6.5-1.1 1.1-1.1h11c.6 0 1.1.5 1.1 1.1-.1.6-.5 1.1-1.1 1.1zm15.7 0H53.8c-.6 0-1.1-.5-1.1-1.1 0-.6.5-1.1 1.1-1.1h10.9c.6 0 1.1.5 1.1 1.1 0 .6-.5 1.1-1.1 1.1zm15.8 0H69.6c-.6 0-1.1-.5-1.1-1.1 0-.6.5-1.1 1.1-1.1h10.9c.6 0 1.1.5 1.1 1.1 0 .6-.5 1.1-1.1 1.1z">
</path>
<path class="st40" d="M53.2 36.6h-3.6c-2.2 0-4-1.8-4-4v-.3c0-2.2 1.8-4 4-4h3.6c2.2 0 4 1.8 4 4v.3c0 2.2-1.8 4-4 4zm15.7 0h-3.6c-2.2 0-4-1.8-4-4v-.3c0-2.2 1.8-4 4-4h3.6c2.2 0 4 1.8 4 4v.3c0 2.2-1.8 4-4 4zM76.8 50h-3.6c-2.2 0-4-1.8-4-4v-.3c0-2.2 1.8-4 4-4h3.6c2.2 0 4 1.8 4 4v.3c0 2.2-1.8 4-4 4zm-47.3 0h-3.6c-2.2 0-4-1.8-4-4v-.3c0-2.2 1.8-4 4-4h3.6c2.2 0 4 1.8 4 4v.3c0 2.2-1.8 4-4 4z"></path><path class="st0" d="M25.2 47.3H14.3c-.6 0-1.1-.5-1.1-1.1 0-.6.5-1.1 1.1-1.1h10.9c.6 0 1.1.5 1.1 1.1 0 .6-.5 1.1-1.1 1.1zm15.6 0h-11c-.6 0-1.1-.5-1.1-1.1 0-.6.5-1.1 1.1-1.1h10.9c.6 0 1.1.5 1.1 1.1.1.6-.4 1.1-1 1.1zm15.7 0H45.6c-.6 0-1.1-.5-1.1-1.1 0-.6.5-1.1 1.1-1.1h10.9c.6 0 1.1.5 1.1 1.1 0 .6-.5 1.1-1.1 1.1zm15.8 0H61.4c-.6 0-1.1-.5-1.1-1.1 0-.6.5-1.1 1.1-1.1h10.9c.6 0 1.1.5 1.1 1.1 0 .6-.5 1.1-1.1 1.1zm17.1 0h-11c-.6 0-1.1-.5-1.1-1.1 0-.6.5-1.1 1.1-1.1h10.9c.6 0 1.1.5 1.1 1.1 0 .6-.5 1.1-1 1.1z"></path><path class="st40" d="M45 50h-3.6c-2.2 0-4-1.8-4-4v-.3c0-2.2 1.8-4 4-4H45c2.2 0 4 1.8 4 4v.3c0 2.2-1.8 4-4 4zm15.7 0H57c-2.2 0-4-1.8-4-4v-.3c0-2.2 1.8-4 4-4h3.6c2.2 0 4 1.8 4 4v.3c.1 2.2-1.7 4-3.9 4z"></path><path class="st18" d="M100.2 85.5H3.1c-.6 0-1.1-.5-1.1-1.2l8.5-19.9c0-.7.5-1.2 1.1-1.2h79.6c.6 0 1.1.6 1.1 1.2l9 19.9c0 .7-.5 1.2-1.1 1.2zM90.6 15H12.2c-.6 0-1.1.6-1.1 1.2V63h80.7V16.3c-.1-.7-.6-1.3-1.2-1.3zm-4.7 39.7c0 1.3-1.1 2.3-2.3 2.3H19.2c-1.3 0-2.3-1.1-2.3-2.3V23.3c0-1.3 1.1-2.3 2.3-2.3h64.4c1.3 0 2.3 1.1 2.3 2.3v31.4z"></path><path class="st10" d="M65.5 80.2H35.4c-.5 0-1-.7-1-1.6l1.4-6c0-.9.4-1.6 1-1.6H64c.5 0 1 .7 1 1.6l1.4 6c.1.9-.4 1.6-.9 1.6z"></path></g>
</svg></center>
         }
      }

class Chain
      {
        constructor()
        {
          this.chain = [this.createGenesisBlock()];
          this.difficulty=1;                                                                                       
        }
      
         createGenesisBlock()
          {
           return new Block(0,date_time(),"Genesis Block","0");
            }
      
            getLatestBlock()
           {
           return this.chain[this.chain.length - 1];
         }
      
        addBlock(newBlock)
        {
          newBlock.previousHash = this.getLatestBlock().hash;
          newBlock.mineBlock(this.difficulty);
          this.chain.push(newBlock);
        }
        
        isChainValid()
        {
          for (var i = 1 ; i&lt; this.chain.length ; i++)
            {
              const currentBlock = this.chain[i];
              const previousBlock = this.chain[i-1];
              
              if (currentBlock.hash !== currentBlock.calculateHash())
              {
                 return false;
              }
              if (currentBlock.previousHash !== previousBlock.hash)
              {
                  return false;
              }
              return true;
            }
        }
        class Blockchain
{
	constructor()
	{
		this.chain = [this.createGenesisBlock()];
    this.difficulty=1;                                                        
	}

	createGenesisBlock()
	{
		return new Block(0,date_time(),"Genesis Block","0");
	}

	getLatestBlock()
	{
		return this.chain[this.chain.length - 1];
	}

	addBlock(newBlock)
	{
		newBlock.previousHash = this.getLatestBlock().hash;
		newBlock.mineBlock(this.difficulty);
		this.chain.push(newBlock);
	}
  
  isChainValid()
  {
    for (var i = 1 ; i&lt; this.chain.length ; i++)
      {
        const currentBlock = this.chain[i];
        const previousBlock = this.chain[i-1];
        
        if (currentBlock.hash !== currentBlock.calculateHash())
        {
           return false;
        }
        if (currentBlock.previousHash !== previousBlock.hash)
        {
            return false;
        }
        return true;
      }
    }
  }
}</pre><h1>- [2] : В формате <a href="https://ru.wikipedia.org/wiki/JSON" target="blank">JSON</a> добавляем блоки в распределенный реестр <a href="https://ru.wikipedia.org/wiki/IPFS" target="blank">IPFS</a></h1>
     <h1> (соединяет все вычислительные устройства сети единой файловой системой)</h1>
    <pre>node.files.add(new node.types.Buffer('<json id="json"></json>'), (err, filesAdded) => {
      if (err) {
        return console.error('ошибка')
      }

      filesAdded.forEach((file) => console.log('successfully stored', file.hash))
    })</pre>
 
  <!--<h1> - 2 : полученные цепочки кладем в распределенную хэш таблицу, получаем ключ </h1>
  <h2> (одноранговая распределенная файловая система соединяет все вычислительные устройства единой системой файлов)</h2>-->

  <h1 style="font-weight:900;display: inline-block;">- [3] : получаем ключ : </h1><span id="hashtablehash"> ----</span>
    <h1> - проверяем командой в console :</h1>
    <pre>    node.files.cat('<span id="hashtable_hash"></span>', function (err, data) {
        if (err) {
          return console.error('ошибка')
        }
  
        console.log(data.toString())
      })</pre>
    <h1> - С помощью ключа <span id="hash_table_hash"></span> получаем из распределённого хранилища JSON файл с нужными блоками <br> вывод :</h1>
  
    <pre>
     
    <json id="jsn"></json>
    
    </pre>
	
	</div>
 
    <script  src="js/index.js"></script>
</body>
</html>
