<!DOCTYPE html>
<html lang="ru" >
<head>	
  <meta charset="UTF-8">
  <title>Chains</title>
  <link rel="stylesheet" href="css/style.css">
 </head>
<body>
    <div class="container">
    <h1 id="time"></h1><h1 id="t"> - [0] : </h1><h1 id="status">*:*</h1></h1>
    <code id="a1" style="display:none;"></code>
    <!--<br>-->
    <decrypted id="a2"></decrypted>
    <h1> - [1] : создание блоков</h1>
    <pre>class Block
      {
        constructor(index, timeStamp, data, previousHash)
        {
          this.index = index;                                                                                                             
          this.timeStamp = timeStamp;                                                                                                                 
          this.data = data;
          this.previousHash = previousHash;
          this.hash = this.calculateHash();
          this.nonce = 0;                                                                                                   
        }      
        calculateHash()						             
        {
        return Encrypt.SHA256(this.index + this.previousHash + this.timeStamp + this.data + this.nonce).toString();
        }        
        mineBlock(difficulty)                                                                                                         
        {
          while(this.hash.substring(0,difficulty) !== Array(difficulty + 1).join("0"))
            {
              this.nonce++;
              this.hash = this.calculateHash();
            }
          console.log(" + блок "+this.index+" : " + this.hash);<center style="
    position:absolute;right:30%;/*top:140px;*/"><svg xmlns="
http://www.w3.org/2000/svg
" width="103" height="101.4" viewBox="0 0 103 101.4">
<circle class="st16" cx="51.7" cy="50.7" r="50.7" id="Layer_3"></circle>
<g id="stuffs"><path class="st29" d="M84.9 56.1H17.8c-.6 0-1-.5-1-1V22.3c0-.5.4-1 1-1h67.1c.5 0 1 .5 1 1v32.8c0 .6-.4 1-1 1z">
</path>
<path class="st17" d="M101.3 88.5V94c0 .7-.5 1.2-1.1 1.2H3.1c-.6 0-1.1-.6-1.1-1.2v-5.5">
</path>
<path class="st22" d="M90.6 15H12.2c-.6 0-1.1.6-1.1 1.2V63h80.7V16.3c-.1-.7-.6-1.3-1.2-1.3zm-3.5 42.8c-.7.7-7.1 1-8.9 1-5.2 0-23.2-.5-23.7-.5h-9.6c-.6 0-27.3.6-28.1-.1-.7-.7-1.4-2.9-1.2-4 0-.4-.5-31.5.1-32.1 1.5-1.3 3.3-1.8 5.1-2 .7-.1 1.4-.1 2.2-.2 7.1-.5 49.6-.5 55.5-.4 10.6.3 8.6 2.1 8.3 8.5-.3 8 1.3 28.8.3 29.8zm14.2 26.5l-9-19.9c0-.7-.5-1.2-1.1-1.2H11.6c-.6 0-1.1.6-1.1 1.2L2 84.3v4.4c0 .7.5 1.2 1.1 1.2h97.1c.6 0 1.1-.6 1.1-1.2v-4.1h-.1c.1-.1.1-.2.1-.3zm-35.6-4.8l-.3.3c-.2.4-.5.7-1.1.8H64c-1 .3-2.2.3-3.2.3-3.4.1-6.8-.1-10.3-.3-4.9.9-9.7 1.8-14.5-.1-.6-.2-1.1-.8-.9-1.5.1-.4.3-.9.5-1.6.1-1.5.4-2.6 1-3.4.1-.2.1-.4.1-.5.1-1.1 1.4-1.5 2.1-1 1.2-.4 2.8-.5 4.6-.4 4.2.1 8.3.6 12.5.3 2.2-.1 4.7-.6 6.8.2 2.6 1 5.1 4.3 3 6.9z">
</path>
<path class="st18" d="M101.3 84.3v5.5c0 .7-.5 1.2-1.1 1.2H3.1c-.6 0-1.1-.6-1.1-1.2v-5.5">
</path>
<path class="st40" d="M22 36.6h-3.6c-2.2 0-4-1.8-4-4v-.3c0-2.2 1.8-4 4-4H22c2.2 0 4 1.8 4 4v.3c0 2.2-1.8 4-4 4zm63 0h-3.6c-2.2 0-4-1.8-4-4v-.3c0-2.2 1.8-4 4-4H85c2.2 0 4 1.8 4 4v.3c0 2.2-1.8 4-4 4zm-47.3 0H34c-2.2 0-4-1.8-4-4v-.3c0-2.2 1.8-4 4-4h3.6c2.2 0 4 1.8 4 4v.3c.1 2.2-1.7 4-3.9 4z">
</path>
<path class="st0" d="M33.4 33.9H22.5c-.6 0-1.1-.5-1.1-1.1 0-.6.5-1.1 1.1-1.1h10.9c.6 0 1.1.5 1.1 1.1 0 .6-.5 1.1-1.1 1.1zm15.6 0H38c-.6 0-1.1-.5-1.1-1.1 0-.6.5-1.1 1.1-1.1h11c.6 0 1.1.5 1.1 1.1-.1.6-.5 1.1-1.1 1.1zm15.7 0H53.8c-.6 0-1.1-.5-1.1-1.1 0-.6.5-1.1 1.1-1.1h10.9c.6 0 1.1.5 1.1 1.1 0 .6-.5 1.1-1.1 1.1zm15.8 0H69.6c-.6 0-1.1-.5-1.1-1.1 0-.6.5-1.1 1.1-1.1h10.9c.6 0 1.1.5 1.1 1.1 0 .6-.5 1.1-1.1 1.1z">
</path>
<path class="st40" d="M53.2 36.6h-3.6c-2.2 0-4-1.8-4-4v-.3c0-2.2 1.8-4 4-4h3.6c2.2 0 4 1.8 4 4v.3c0 2.2-1.8 4-4 4zm15.7 0h-3.6c-2.2 0-4-1.8-4-4v-.3c0-2.2 1.8-4 4-4h3.6c2.2 0 4 1.8 4 4v.3c0 2.2-1.8 4-4 4zM76.8 50h-3.6c-2.2 0-4-1.8-4-4v-.3c0-2.2 1.8-4 4-4h3.6c2.2 0 4 1.8 4 4v.3c0 2.2-1.8 4-4 4zm-47.3 0h-3.6c-2.2 0-4-1.8-4-4v-.3c0-2.2 1.8-4 4-4h3.6c2.2 0 4 1.8 4 4v.3c0 2.2-1.8 4-4 4z"></path><path class="st0" d="M25.2 47.3H14.3c-.6 0-1.1-.5-1.1-1.1 0-.6.5-1.1 1.1-1.1h10.9c.6 0 1.1.5 1.1 1.1 0 .6-.5 1.1-1.1 1.1zm15.6 0h-11c-.6 0-1.1-.5-1.1-1.1 0-.6.5-1.1 1.1-1.1h10.9c.6 0 1.1.5 1.1 1.1.1.6-.4 1.1-1 1.1zm15.7 0H45.6c-.6 0-1.1-.5-1.1-1.1 0-.6.5-1.1 1.1-1.1h10.9c.6 0 1.1.5 1.1 1.1 0 .6-.5 1.1-1.1 1.1zm15.8 0H61.4c-.6 0-1.1-.5-1.1-1.1 0-.6.5-1.1 1.1-1.1h10.9c.6 0 1.1.5 1.1 1.1 0 .6-.5 1.1-1.1 1.1zm17.1 0h-11c-.6 0-1.1-.5-1.1-1.1 0-.6.5-1.1 1.1-1.1h10.9c.6 0 1.1.5 1.1 1.1 0 .6-.5 1.1-1 1.1z"></path><path class="st40" d="M45 50h-3.6c-2.2 0-4-1.8-4-4v-.3c0-2.2 1.8-4 4-4H45c2.2 0 4 1.8 4 4v.3c0 2.2-1.8 4-4 4zm15.7 0H57c-2.2 0-4-1.8-4-4v-.3c0-2.2 1.8-4 4-4h3.6c2.2 0 4 1.8 4 4v.3c.1 2.2-1.7 4-3.9 4z"></path><path class="st18" d="M100.2 85.5H3.1c-.6 0-1.1-.5-1.1-1.2l8.5-19.9c0-.7.5-1.2 1.1-1.2h79.6c.6 0 1.1.6 1.1 1.2l9 19.9c0 .7-.5 1.2-1.1 1.2zM90.6 15H12.2c-.6 0-1.1.6-1.1 1.2V63h80.7V16.3c-.1-.7-.6-1.3-1.2-1.3zm-4.7 39.7c0 1.3-1.1 2.3-2.3 2.3H19.2c-1.3 0-2.3-1.1-2.3-2.3V23.3c0-1.3 1.1-2.3 2.3-2.3h64.4c1.3 0 2.3 1.1 2.3 2.3v31.4z"></path><path class="st10" d="M65.5 80.2H35.4c-.5 0-1-.7-1-1.6l1.4-6c0-.9.4-1.6 1-1.6H64c.5 0 1 .7 1 1.6l1.4 6c.1.9-.4 1.6-.9 1.6z"></path></g>
</svg>
</center>}
      }

class Blockchain
      {
        constructor()
        {
          this.chain = [this.createGenesisBlock()];
          this.difficulty=1;                                                                                       
        }
      
         createGenesisBlock()
          {
           return new Block(0,date_time(),"Genesis Block","0");
            }
      
            getLatestBlock()
           {
           return this.chain[this.chain.length - 1];
         }
      
        addBlock(newBlock)
        {
          newBlock.previousHash = this.getLatestBlock().hash;
          newBlock.mineBlock(this.difficulty);
          this.chain.push(newBlock);
        }
        
        isChainValid()
        {
          for (var i = 1 ; i< this.chain.length ; i++)
            {
              const currentBlock = this.chain[i];
              const previousBlock = this.chain[i-1];
              
              if (currentBlock.hash !== currentBlock.calculateHash())
              {
                 return false;
              }
              if (currentBlock.previousHash !== previousBlock.hash)
              {
                  return false;
              }
              return true;
            }
        }
        class Blockchain
{
	constructor()
	{
		this.chain = [this.createGenesisBlock()];
    this.difficulty=1;                                                        
	}

	createGenesisBlock()
	{
		return new Block(0,date_time(),"Genesis Block","0");
	}

	getLatestBlock()
	{
		return this.chain[this.chain.length - 1];
	}

	addBlock(newBlock)
	{
		newBlock.previousHash = this.getLatestBlock().hash;
		newBlock.mineBlock(this.difficulty);
		this.chain.push(newBlock);
	}
  
  isChainValid()
  {
    for (var i = 1 ; i< this.chain.length ; i++)
      {
        const currentBlock = this.chain[i];
        const previousBlock = this.chain[i-1];
        
        if (currentBlock.hash !== currentBlock.calculateHash())
        {
           return false;
        }
        if (currentBlock.previousHash !== previousBlock.hash)
        {
            return false;
        }
        return true;
      }
    }
  }
}</pre>
     <h1>- [2] : В формате <a href="https://ru.wikipedia.org/wiki/JSON" target="blank">JSON</a> добавляем блоки в распределенный реестр <a href="https://ru.wikipedia.org/wiki/IPFS" target="blank">IPFS</a></h1>
     <h1> (соединяет все вычислительные устройства сети единой файловой системой)</h1>
    <pre>
    <center style="
    position:absolute;
    right:30%;
    /*top:140px;*/
	    ">
	    <img src="css/world.png" style="
    width: 103px;
">
	    </center>
    node.files.add(new node.types.Buffer('<json id="json"></json>'), (err, filesAdded) => {
      if (err) {
        return console.error('ошибка')
      }

      filesAdded.forEach((file) => console.log('successfully stored', file.hash))
    })</pre>
 
  <!--<h1> - 2 : полученные цепочки кладем в распределенную хэш таблицу, получаем ключ </h1>
  <h2> (одноранговая распределенная файловая система соединяет все вычислительные устройства единой системой файлов)</h2>-->

  <h1 style="font-weight:900;display: inline-block;">- [3] : получаем ключ : </h1><span id="hashtablehash"> ----</span>
    <h1> - проверяем командой в console :</h1>
    <pre>    node.files.cat('<span id="hashtable_hash"></span>', function (err, data) {
        if (err) {
          return console.error('ошибка')
        }
  
        console.log(data.toString())
      })</pre>
    <h1> - С помощью ключа <span id="hash_table_hash"></span> получаем обратно JSON файл с нужными блоками <br> вывод :</h1>
  
    <pre>
     
    <json id="jsn"></json>
    
    </pre>
 
    <script  src="js/index.js"></script>
</body>
</html>
